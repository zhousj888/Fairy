1ã€CallFuncï¼š
push FuncCodeObj
createNewEnv
save params to currentEnv
funcRunInstance = FuncCodeObj.newRunInstanceWithEnv(mainEnv)
funcRunInstance.callerInstance = self
funcRunInstance.runWithParams(currentEnv)
currentEnv = currentEnv.outer

retValue = pop()

2ã€return
vm.stackPoint = self.callerInstance.stackPoint
push result
self.callerInstance.resume


3ã€newInstance
push ClassCodeObj
createNewEnv
save params to currentEnv
funcRunInstance = ClassCodeObj.newRunInstanceWithEnv(mainEnv)
funcRunInstance.callerInstance = self
funcRunInstance.runWithParams(currentEnv)
currentEnv = currentEnv.outer
retValue = pop()


4ã€callInstanceFunc
push obj
getProperty funcName and push
createNewEnv
save params to currentEnv
funcRunInstance = ClassCodeObj.newRunInstanceWithEnv(mainEnv)
funcRunInstance.callerInstance = self
funcRunInstance.runWithParams(currentEnv)
currentEnv = currentEnv.outer
retValue = pop()


5ã€callFuncWithClosure
push funcName
createNewEnv
save params to currentEnv

push ClosureCodeObj
save ClosureCodeObj.newRunInstanceWithEnv(currentEnv) -> closureParma

funcRunInstance = ClassCodeObj.newRunInstanceWithEnv(mainEnv)
funcRunInstance.callerInstance = self
funcRunInstance.runWithParams(currentEnv)
currentEnv = currentEnv.outer
retValue = pop()

6ã€initInstanceProcess
isa = ClassCodeObj
super = call superClass init
init member variable
return self

7ã€getPropertyProcess
find currentEnv[funcName]
find isa class
find super.getProperty


8ã€funcFinish
array = pop() to callerInstance.stackPoint
vm.stackPoint = self.callerInstance.stackPoint
push array
self.callerInstance.resume


9ã€arrayConst
save stack stackPoint as arrayStart
push
push
push
push stackObj from arrayStart to arrayEnd


10ã€dicConst
createNewEnv
push save
push save
push save
push dic with currentEnv
currentEnv = currentEnv.outer


11ã€vmControllRegular

create mainEnv
push MainCodeObj
mainCodeInstance = MainCodeObj.newRunInstanceWithEnv(mainEnv)
mainCodeInstance.runWithParams(currentEnv)


12ã€æ–¹æ³•é‡è½½ï¼šğŸˆšï¸
13ã€æ–¹æ³•è¦†å†™ï¼šself -> super

14ã€jmpå’Œcallå…¼å®¹
ç›´æ¥instanceRunCode,æ²¡æœ‰codeExcutor

15ã€ç›´æ¥ç”Ÿæˆæ–¹æ³•å®ä¾‹